<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Your Romantic Tulip Garden</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    color: #4b2e39;
    background: linear-gradient(to bottom, #87ceeb, #a3d9a5, #2d8c27);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    padding-bottom: 300px; /* space for tulips */
  }
  h1 { font-size: 3rem; margin: 20px 0 0; color: #d6336c; }
  .heart { font-size: 4rem; animation: heartbeat 1.5s infinite; }
  @keyframes heartbeat { 0%,100%{transform:scale(1);}50%{transform:scale(1.2);} }
  #messageBox { font-size:1.4rem; margin:20px 0; text-align:center; white-space:pre-wrap; transition:opacity .4s; }
  button { padding:12px 25px; background:#d6336c; color:#fff; border:none;border-radius:25px;cursor:pointer; transition:background .3s; margin:5px; }
  button:hover{background:#a1284f;}
  #controls { margin:10px; }
  #timer { font-size:1.1rem; margin-top:10px; }
  #garden { position:absolute; bottom:0; left:0; width:100%; height:280px; pointer-events:none; }
  .tulip {
    position:absolute; pointer-events:auto;
    width:80px; user-select:none;
    transition:transform .3s;
    animation:sway 4s ease-in-out infinite;
    cursor:grab;
  }
  .tulip:hover { transform:scale(1.2) rotate(-5deg); }
  @keyframes sway { 0%,100%{transform:rotateY(0deg);}50%{transform:rotateY(10deg);} }
  #spotifyPlayer {
    margin-top: 20px;
    width: 300px;
    max-width: 100%;
  }
  #userInfo {
    margin-top: 15px;
    font-size: 1.3rem;
    font-weight: 600;
    color: #d6336c;
  }
</style>
</head>
<body>

<h1>For You ‚ù§Ô∏è</h1>
<div class="heart">‚ù§Ô∏è</div>
<div id="messageBox">Click "Next" to see a special message...</div>
<div id="controls">
  <button id="nextBtn">Next Message</button>
  <button id="loginBtn">Login with Spotify</button>
</div>

<div id="userInfo"></div>

<div id="spotifyPlayer">
  <iframe style="border-radius:12px" 
    src="https://open.spotify.com/embed/track/0D1ecMMsSIpJbjPoJMHGkV?utm_source=generator" 
    width="100%" height="352" frameborder="0" 
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
    loading="lazy"></iframe>
</div>

<div id="timer"></div>

<div id="garden"></div>

<footer style="margin-top:30px; font-size:.9rem; color:#a67a8d;">&copy; 2025 ‚Äî Made with care</footer>

<script>
// Messages
const messages = [
"Thinking of you and hoping you‚Äôre well.",
"Sometimes I miss the moments we shared.",
"Wishing you happiness wherever you are.",
"There‚Äôs a quiet space left by your absence.",
"I hope life is treating you kindly."
];
let idx=0;
document.getElementById('nextBtn').onclick = () => {
  idx=(idx+1)%messages.length;
  const box=document.getElementById('messageBox');
  box.style.opacity=0;
  setTimeout(()=>{box.textContent=messages[idx];box.style.opacity=1;},300);
};

// Countdown
const target=new Date('2025-09-01T00:00:00');
function updateTimer(){
  const now=new Date(), diff=target-now;
  document.getElementById('timer').textContent = diff>0
   ? `Countdown: ${Math.floor(diff/86400000)}d ${Math.floor(diff%86400000/3600000)}h ${Math.floor(diff%3600000/60000)}m`
   : 'üå∏ It‚Äôs today! üå∏';
}
setInterval(updateTimer,1000);
updateTimer();

// Garden generation and drag-drop
const garden = document.getElementById('garden');
const tulipURLs = [
  "https://gallery.yopriceville.com/var/resizes/Free-Clipart-Pictures/Flowers-PNG/Red_Tulip_Flower_Transparent_Image.png?m=1629831687",
  "https://gallery.yopriceville.com/var/resizes/Free-Clipart-Pictures/Flowers-PNG/Red_Tulip_Transparent_Clip_Art_Image.png?m=1629831687",
  "https://purepng.com/photo/18869/tulip.png"
];
function rand(min,max){return min+Math.random()*(max-min);}

for(let row=0; row<3; row++){  
  for(let i=0; i<20; i++){  
    const img=document.createElement('img');
    img.src=tulipURLs[Math.floor(Math.random()*tulipURLs.length)];
    img.className='tulip';
    img.style.bottom=`${10 + row*90 + rand(-10,10)}px`;
    img.style.left=`${rand(0,90)}%`;
    img.style.transform=`scale(${rand(0.8,1.3)})`;
    img.draggable=true;
    garden.appendChild(img);

    img.addEventListener('dragstart',e=>{
      e.dataTransfer.setData('text/plain','');
      img.style.opacity=0.5;
    });
    img.addEventListener('dragend',e=>{
      img.style.opacity=1;
      const x=e.pageX/window.innerWidth*100;
      img.style.left=`${x}%`;
    });
  }
}

garden.addEventListener('dragover',e=>e.preventDefault());
garden.addEventListener('drop',e=>e.preventDefault());

// Spotify login flow

document.getElementById('loginBtn').onclick = () => {
  // Redirect user to backend login route (change URL if needed)
  window.location.href = 'http://localhost:8888/login';
};

// On page load, check for access_token in URL
window.onload = async function() {
  const params = new URLSearchParams(window.location.search);
  const token = params.get('access_token');
  if (token) {
    try {
      const res = await fetch('https://api.spotify.com/v1/me', {
        headers: { Authorization: 'Bearer ' + token }
      });
      const data = await res.json();
      document.getElementById('userInfo').textContent = 'Logged in as: ' + data.display_name;
    } catch (e) {
      console.error('Error fetching Spotify profile', e);
    }
  }
};
</script>

</body>
</html>
